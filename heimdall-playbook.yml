---
- hosts: all

  tasks:
  - name: Add Ansible PPA
    apt_repository:
      repo: 'ppa:ansible/ansible'

  tasks:
  - name: Update ansible to the latest version 
    apt:
      update_cache: yes
      name: ansible
      state: present

  tasks:
  - name: Install Packages
    apt: name={{item}} update_cache=yes state=latest
    with_items:
      - git
      - php7.0
      - php7.0-mbstring
      - php7.0-sqlite3
      - sqlite3
  - name: create /var/www/ directory
    file: dest=/var/www/ state=directory owner=www-data group=www-data mode=0700


  - name: ensure php5-fpm cgi.fix_pathinfo=0
    lineinfile: dest=/etc/php/7.0/fpm/php.ini regexp='^(.*)cgi.fix_pathinfo=' line=cgi.fix_pathinfo=0
    notify:
      - restart php5-fpm
      - restart nginx

  - name: Start Nginx service
    service: name=nginx enabled=yes state=started

    
  tasks:
  - name: Clone Git Repo
    git: >
      dest: /var/www/html
      repo: 'https://github.com/linuxserver/Heimdall'
      clone: yes
    become: true
    become_user: www-data

  handlers:
  - name: restart php5-fpm
    service: name=php5-fpm state=restarted
  
  - name: restart nginx
    service: name=nginx state=restarted